name: 'Install picotool'
description: 'Installs the picotool executable from raspberry/picotool.'
runs:
  using: "composite"
  steps:
    # Check out the SDK (used by picotool)
    - name: Checkout pico-sdk
      uses: actions/checkout@v4
      with:
        repository: raspberrypi/pico-sdk
        path: pico-sdk
        ref: a1438dff1d38bd9c65dbd693f0e5db4b9ae91779

    # Check out picotool itself
    - name: Checkout picotool
      uses: actions/checkout@v4
      with:
        repository: raspberrypi/picotool
        path: picotool
        ref: 25aa087b2c517b4901874a99536e869d4d27b678

    # Make sure we have cmake etc
    - name: Install build dependencies
      run: sudo apt install -y build-essential pkg-config libusb-1.0-0-dev cmake
      shell: bash

    # Build and install
    - name: Build picotool
      run: |
        export PICO_SDK_PATH=$GITHUB_WORKSPACE/pico-sdk
        cd $GITHUB_WORKSPACE/picotool
        mkdir build
        cd build
        cmake ..
        make
        sudo make install
      shell: bash
